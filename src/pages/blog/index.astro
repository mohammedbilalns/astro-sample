---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const posts = await getCollection("blog");

// Sort newest → oldest
posts.sort(
  (a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);
---

<BaseLayout
  title="Blog – AevonSolutions"
  description="Articles on web, mobile, and software development."
>
  <!-- Hero -->
  <section class="py-20 lg:py-24 bg-slate-50 dark:bg-slate-900/50">
    <div class="px-6 mx-auto max-w-7xl text-center">
      <h1 class="animate-on-scroll text-5xl font-extrabold text-slate-900 dark:text-white mb-6">Our Blog</h1>
      <p class="animate-on-scroll delay-100 text-xl text-slate-700 dark:text-slate-200 max-w-2xl mx-auto">
        Insights, updates, and thoughts on the future of technology and software development.
      </p>
    </div>
  </section>

  <!-- Blog Grid -->
  <section class="py-20">
    <div class="px-6 mx-auto max-w-7xl">
      <div class="grid gap-10 md:grid-cols-2 lg:grid-cols-3">
        {posts.map((post, index) => (
        <article class="animate-on-scroll flex flex-col h-full bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden hover:shadow-md transition-shadow" style={`animation-delay: ${index * 100}ms`}>
          <!-- Image placeholder (optional) -->
          <div class="h-48 bg-slate-200 dark:bg-slate-700 w-full object-cover"></div> 
          
          <div class="flex-1 p-8 flex flex-col">
            <div class="text-sm text-blue-700 dark:text-blue-400 font-medium mb-3">
               {new Date(post.data.publishDate).toLocaleDateString(undefined, { dateStyle: 'medium' })}
            </div>
            
            <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-4 leading-tight group-hover:text-blue-600 transition-colors">
              <a href={`/blog/${post.slug}`} class="hover:underline decoration-blue-500/30">
                {post.data.title}
              </a>
            </h2>

            <p class="text-slate-700 dark:text-slate-300 flex-1 line-clamp-3 mb-6">
              {post.data.description}
            </p>

            <a href={`/blog/${post.slug}`} class="inline-flex items-center text-blue-700 dark:text-blue-400 font-semibold hover:text-blue-800 dark:hover:text-blue-300 transition">
              Read Article <span class="ml-2">→</span>
            </a>
          </div>
        </article>
        ))}
      </div>
    </div>
  </section>

  <script>
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
        if (entry.isIntersecting) {
            (entry.target as HTMLElement).style.animationPlayState = 'running';
            observer.unobserve(entry.target);
        }
        });
    }, observerOptions);

    document.addEventListener('DOMContentLoaded', () => {
        const animatedElements = document.querySelectorAll('.animate-on-scroll');
        animatedElements.forEach(el => {
        (el as HTMLElement).style.animationPlayState = 'paused';
        observer.observe(el);
        });
    });
  </script>
</BaseLayout>